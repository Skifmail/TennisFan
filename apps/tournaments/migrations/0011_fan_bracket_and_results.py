# Generated by Django 6.0.1 on 2026-01-29 08:21

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('tournaments', '0010_alter_seasonrating_category_and_more'),
        ('users', '0014_registration_optional_fields_forehand_label'),
    ]

    operations = [
        migrations.AddField(
            model_name='match',
            name='deadline',
            field=models.DateTimeField(blank=True, help_text='До этой даты матч должен быть сыгран (FAN).', null=True, verbose_name='Дедлайн матча'),
        ),
        migrations.AddField(
            model_name='match',
            name='is_consolation',
            field=models.BooleanField(default=False, verbose_name='Подвал (матч вылетевших)'),
        ),
        migrations.AddField(
            model_name='match',
            name='next_match',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='prev_matches', to='tournaments.match', verbose_name='Следующий матч (победитель)'),
        ),
        migrations.AddField(
            model_name='match',
            name='round_index',
            field=models.PositiveSmallIntegerField(default=1, help_text='Для сортировки и FAN-очков.', verbose_name='Индекс раунда (1=1 круг, 2=2 круг, …)'),
        ),
        migrations.AddField(
            model_name='match',
            name='round_order',
            field=models.PositiveSmallIntegerField(default=1, help_text='Номер пары в раунде (1–8 для 16 участников в R1).', verbose_name='Порядок матча в раунде'),
        ),
        migrations.AddField(
            model_name='tournament',
            name='bracket_generated',
            field=models.BooleanField(default=False, help_text='FAN: сетка создана по рейтингу, регистрация закрыта.', verbose_name='Сетка сформирована'),
        ),
        migrations.AddField(
            model_name='tournament',
            name='fan_points_final',
            field=models.PositiveSmallIntegerField(default=70, verbose_name='FAN: очки финалисту'),
        ),
        migrations.AddField(
            model_name='tournament',
            name='fan_points_r1',
            field=models.PositiveSmallIntegerField(default=10, verbose_name='FAN: очки за 1 круг'),
        ),
        migrations.AddField(
            model_name='tournament',
            name='fan_points_r2',
            field=models.PositiveSmallIntegerField(default=25, verbose_name='FAN: очки за 2 круг'),
        ),
        migrations.AddField(
            model_name='tournament',
            name='fan_points_sf',
            field=models.PositiveSmallIntegerField(default=45, verbose_name='FAN: очки за полуфинал'),
        ),
        migrations.AddField(
            model_name='tournament',
            name='fan_points_winner',
            field=models.PositiveSmallIntegerField(default=100, verbose_name='FAN: очки победителю'),
        ),
        migrations.AddField(
            model_name='tournament',
            name='format',
            field=models.CharField(choices=[('single_elimination', 'FAN (одноэтапная сетка)'), ('other', 'Другой')], default='other', help_text='FAN: одноэтапная сетка, посев по рейтингу, очки при вылете.', max_length=20, verbose_name='Формат'),
        ),
        migrations.AddField(
            model_name='tournament',
            name='match_days_per_round',
            field=models.PositiveSmallIntegerField(default=7, help_text='FAN: сколько дней у игроков на проведение матча раунда.', verbose_name='Дней на раунд (дедлайн матча)'),
        ),
        migrations.AlterField(
            model_name='tournament',
            name='max_participants',
            field=models.PositiveIntegerField(blank=True, help_text='Обязательно для FAN. Оставьте пустым для неограниченного количества.', null=True, verbose_name='Максимальное количество участников'),
        ),
        migrations.CreateModel(
            name='TournamentPlayerResult',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('round_eliminated', models.CharField(choices=[('r1', '1 круг'), ('r2', '2 круг'), ('sf', 'Полуфинал'), ('final', 'Финал'), ('winner', 'Победитель')], max_length=10, verbose_name='Раунд вылета')),
                ('fan_points', models.PositiveIntegerField(default=0, verbose_name='Начислено очков FAN')),
                ('is_consolation', models.BooleanField(default=False, verbose_name='Вылет в подвале')),
                ('player', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tournament_fan_results', to='users.player')),
                ('tournament', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='fan_results', to='tournaments.tournament')),
            ],
            options={
                'verbose_name': 'Результат в турнире (FAN)',
                'verbose_name_plural': 'Результаты в турнирах (FAN)',
                'ordering': ['-fan_points'],
                'unique_together': {('tournament', 'player')},
            },
        ),
    ]
