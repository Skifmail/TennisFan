# Cookie-баннер и согласие на аналитику

Баннер реализован в соответствии с требованиями РФ и практикой GDPR/ePrivacy: явное согласие или отказ, скрипты аналитики не загружаются до согласия.

## Поведение

- **При первом заходе** (нет cookie `cookie_consent`): показывается баннер внизу страницы с текстом, ссылкой на политику конфиденциальности и кнопками «Принять» / «Отказаться».
- **Принять**: в cookie записывается `cookie_consent=true` (срок 1 год), баннер скрывается. Можно подключать аналитику.
- **Отказаться**: в cookie записывается `cookie_consent=false`, баннер скрывается. Аналитика не должна подключаться.

## Подключение аналитики только после согласия

Скрипты Google Analytics, Яндекс.Метрики и т.п. **не должны** подключаться в `base.html` до выбора пользователя. Варианты:

### 1. Проверка при загрузке страницы

В шаблоне или в отдельном скрипте (например, в `{% block extra_js %}` на нужных страницах):

```html
<script>
(function() {
  if (window.cookieConsentAccepted && window.cookieConsentAccepted()) {
    // вставить загрузку счётчика, например:
    // (function(w,d,s,l,i){...})(window,document,'script','...','GA_ID');
  }
})();
</script>
```

### 2. Событие после согласия

Если пользователь принял cookie на этой вкладке, можно подписаться на событие:

```javascript
window.addEventListener('cookie_consent_accepted', function() {
  loadYandexMetrika(); // или loadGoogleAnalytics();
});
```

Скрипт `cookie_consent.js` подключается в `base.html` после `main.js`. Файлы: `static/js/cookie_consent.js`, стили в `static/css/style.css` (блок «Cookie consent banner»).

## Документы

- В баннере — ссылка на [Политику конфиденциальности](/legal/privacy/) (`legal_privacy`).
- В политике добавлен раздел **11. ИСПОЛЬЗОВАНИЕ ФАЙЛОВ COOKIE** (`static/documents/privacy.txt`): технические и аналитические cookie, согласие/отказ, срок хранения выбора.

## Что делать при отказе

При нажатии «Отказаться»:

- Сохраняется `cookie_consent=false`.
- Баннер больше не показывается (пока пользователь не удалит cookie или не истечёт срок).
- Аналитические и маркетинговые скрипты не загружаются; технические cookie (сессия, авторизация, формы) продолжают использоваться для работы сайта.

Пользователь может позже изменить выбор: удалить cookie `cookie_consent` в настройках браузера и обновить страницу — баннер появится снова.
