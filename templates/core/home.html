{% extends 'base.html' %}
{% load static %}

{% block title %}Главная{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="hero-image-wrapper">
        <img src="{% static 'images/hero_image_1.png' %}" alt="Tennis Player" class="hero-image">
    </div>
    <div class="container">
        <div class="hero-content">
            <h1 class="hero-title">
                Любительские турниры<br>
                по <span>теннису</span>
            </h1>
            <p class="hero-text">
                Аналог ATP Tour для любителей. Равные соперники, честная игра,
                сообщество игроков по всей России.
            </p>
            <div class="hero-buttons">
                {% if not user.is_authenticated %}
                <a href="{% url 'register' %}" class="btn btn-primary btn-lg">Регистрация</a>
                {% endif %}
                <a href="{% url 'rules' %}" class="btn btn-outline btn-lg">Как это работает</a>
            </div>
        </div>
    </div>
</section>

<!-- Tournaments with filters -->
<section class="section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Турниры</h2>
            <div class="d-flex gap-2" style="flex-wrap: wrap;">
                <a href="{% url 'tournament_list' %}" class="btn btn-outline">Все турниры</a>
                <a href="?" class="btn btn-ghost">Сбросить фильтры</a>
            </div>
        </div>

        <form method="get" class="card mb-4">
            <div class="card-body filter-grid">
                <div class="form-group">
                    <label class="form-label">Город</label>
                    <input name="city" class="form-control" placeholder="Любой город России" value="{{ current_filters.city }}">
                </div>
                <div class="form-group">
                    <label class="form-label">Уровень</label>
                    <select name="category" class="form-control">
                        <option value="">Все</option>
                        {% for value, label in category_choices %}
                        <option value="{{ value }}" {% if current_filters.category == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Пол</label>
                    <select name="gender" class="form-control">
                        <option value="">Все</option>
                        {% for value, label in gender_choices %}
                        <option value="{{ value }}" {% if current_filters.gender == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Продолжительность</label>
                    <select name="duration" class="form-control">
                        <option value="">Все</option>
                        {% for value, label in duration_choices %}
                        <option value="{{ value }}" {% if current_filters.duration == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group form-group-submit">
                    <label class="form-label">Применить</label>
                    <button type="submit" class="btn btn-primary">Применить</button>
                </div>
            </div>
        </form>

        <div class="d-flex flex-col gap-2">
            {% for tournament in filtered_tournaments %}
                {% include 'includes/tournament_card.html' with tournament=tournament %}
            {% empty %}
            <p class="text-secondary">Подходящих турниров не найдено.</p>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Top Players -->
<section class="section" style="background: var(--color-bg-secondary);">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Топ рейтинга</h2>
            <a href="{% url 'rating' %}" class="btn btn-outline">Полный рейтинг</a>
        </div>

        <div class="grid">
            {% for player in top_players %}
            <a href="{% url 'profile' pk=player.pk %}" class="player-card">
                <span class="player-rank">{{ forloop.counter }}</span>
                {% if player.avatar %}
                <img src="{{ player.avatar.url|default:'/static/images/avatar-placeholder.png' }}" alt="" class="player-avatar">
                {% else %}
                <div class="player-avatar"></div>
                {% endif %}
                <div class="player-info">
                    <div class="player-name">{{ player }}</div>
                    <span class="player-category">{{ player.get_skill_level_display }}</span>
                </div>
                <div class="player-stats">
                    <div>
                        <div class="stat-value">{{ player.matches_played }}</div>
                        <div class="stat-label">Матчей</div>
                    </div>
                    <div>
                        <div class="stat-value">{{ player.win_rate }}%</div>
                        <div class="stat-label">Побед</div>
                    </div>
                </div>
                <div class="player-points text-primary">{{ player.total_points }}</div>
            </a>
            {% empty %}
            <p class="text-secondary">Рейтинг пока не сформирован.</p>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Upcoming Tournaments -->
<section class="section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Ближайшие турниры</h2>
            <a href="{% url 'tournament_list' %}" class="btn btn-outline">Все турниры</a>
        </div>

        <div class="grid grid-3">
            {% for tournament in upcoming_tournaments %}
            <a href="{% url 'tournament_detail' slug=tournament.slug %}" class="card">
                {% if tournament.image %}
                <img src="{{ tournament.image.url }}" alt="" class="card-image">
                {% endif %}
                <div class="card-body">
                    <span class="player-category mb-1">{{ tournament.get_category_display }}</span>
                    <h3 class="card-title">{{ tournament.name }}</h3>
                    <p class="card-text">
                        {{ tournament.city }} • {{ tournament.start_date|date:"d.m.Y" }}
                    </p>
                </div>
            </a>
            {% empty %}
            <p class="text-secondary">Нет предстоящих турниров.</p>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Latest News -->
{% if latest_news %}
<section class="section" style="background: var(--color-bg-secondary);">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Новости</h2>
            <a href="{% url 'news_list' %}" class="btn btn-outline">Все новости</a>
        </div>

        <div class="grid grid-4">
            {% for news in latest_news %}
            <a href="{% url 'news_detail' slug=news.slug %}" class="card">
                {% if news.image %}
                <img src="{{ news.image.url }}" alt="" class="card-image">
                {% endif %}
                <div class="card-body">
                    <h3 class="card-title">{{ news.title }}</h3>
                    <p class="card-text">{{ news.excerpt|truncatewords:15 }}</p>
                    <p class="text-muted mt-2" style="font-size: var(--font-size-xs);">
                        {{ news.created_at|date:"d.m.Y" }}
                    </p>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}
{% endblock %}