{% extends 'base.html' %}
{% load static %}

{% block title %}Правила{% endblock %}

{% block content %}
<div class="rules-page">
    <div class="container container--rules">
        <header class="rules-header">
            <h1 class="page-title page-title--rules">Правила</h1>
            <p class="page-subtitle">Официальные правила TennisFan</p>
        </header>

        <!-- Вкладки первого уровня -->
        <div class="rules-tabs">
            <div class="rules-tabs__nav" role="tablist">
                <button class="rules-tabs__btn rules-tabs__btn--active" data-tab="tennis-rules" role="tab" aria-selected="true">
                    Правила тенниса
                </button>
                <button class="rules-tabs__btn" data-tab="tournament-rules" role="tab" aria-selected="false">
                    Правила турниров
                </button>
                <button class="rules-tabs__btn" data-tab="site-usage-rules" role="tab" aria-selected="false">
                    Правила пользования сайтом
                </button>
            </div>

            <div class="rules-tabs__content" id="tennis-rules" role="tabpanel">
                <article class="rules-doc card">
                    <div class="card-body rules-doc__body">
                        <h2 class="rules-doc__title">Правила тенниса</h2>
                        <p class="rules-doc__meta rules-doc__meta--links">
                            <a class="rules-doc__doc-link" href="{% static 'documents/2020-rules-of-tennis-english.pdf' %}" target="_blank" rel="noopener">ITF Rules of Tennis 2020 (ENG).</a>
                            <a class="rules-doc__doc-link" href="{% static 'documents/Правила_тенниса_РФ.pdf' %}" target="_blank" rel="noopener">Правила вида спорта "Теннис". Мин.спорта РФ от «28» января 2026 г.</a>
                        </p>
                        {% if rules_content.tennis_rules %}
                            {{ rules_content.tennis_rules|safe }}
                        {% else %}
                            {% include 'core/rules_tennis_editable.html' %}
                        {% endif %}
                    </div>
                </article>
            </div>

            <div class="rules-tabs__content" id="tournament-rules" role="tabpanel" style="display: none;">
                <!-- Вкладки второго уровня: форматы турниров -->
                <div class="rules-subtabs">
                    <div class="rules-subtabs__nav" role="tablist">
                        <button class="rules-subtabs__btn rules-subtabs__btn--active" data-subtab="fan" role="tab" aria-selected="true">
                            FAN (одноэтапная сетка)
                        </button>
                        <button class="rules-subtabs__btn" data-subtab="round-robin" role="tab" aria-selected="false">
                            Круговой
                        </button>
                        <button class="rules-subtabs__btn" data-subtab="olympic" role="tab" aria-selected="false">
                            Олимпийская система
                        </button>
                        <button class="rules-subtabs__btn" data-subtab="doubles" role="tab" aria-selected="false">
                            Парные турниры
                        </button>
                        <button class="rules-subtabs__btn" data-subtab="seeding" role="tab" aria-selected="false">
                            Правила посева
                        </button>
                    </div>

                    <div class="rules-subtabs__content" id="fan" role="tabpanel">
                        <article class="rules-doc card">
                            <div class="card-body rules-doc__body">
                                {% if rules_content.rules_fan %}{{ rules_content.rules_fan|safe }}{% else %}{% include 'core/rules_fan.html' %}{% endif %}
                            </div>
                        </article>
                    </div>
                    <div class="rules-subtabs__content" id="round-robin" role="tabpanel" style="display: none;">
                        <article class="rules-doc card">
                            <div class="card-body rules-doc__body">
                                {% if rules_content.rules_round_robin %}{{ rules_content.rules_round_robin|safe }}{% else %}{% include 'core/rules_round_robin.html' %}{% endif %}
                            </div>
                        </article>
                    </div>
                    <div class="rules-subtabs__content" id="olympic" role="tabpanel" style="display: none;">
                        <article class="rules-doc card">
                            <div class="card-body rules-doc__body">
                                {% if rules_content.rules_olympic %}{{ rules_content.rules_olympic|safe }}{% else %}{% include 'core/rules_olympic.html' %}{% endif %}
                            </div>
                        </article>
                    </div>
                    <div class="rules-subtabs__content" id="doubles" role="tabpanel" style="display: none;">
                        <article class="rules-doc card">
                            <div class="card-body rules-doc__body">
                                {% if rules_content.rules_doubles %}{{ rules_content.rules_doubles|safe }}{% else %}{% include 'core/rules_doubles.html' %}{% endif %}
                            </div>
                        </article>
                    </div>
                    <div class="rules-subtabs__content" id="seeding" role="tabpanel" style="display: none;">
                        <article class="rules-doc card">
                            <div class="card-body rules-doc__body">
                                {% if rules_content.rules_seeding %}{{ rules_content.rules_seeding|safe }}{% else %}{% include 'core/rules_seeding.html' %}{% endif %}
                            </div>
                        </article>
                    </div>
                </div>
            </div>

            <div class="rules-tabs__content" id="site-usage-rules" role="tabpanel" style="display: none;">
                <article class="rules-doc card">
                    <div class="card-body rules-doc__body">
                        {% if rules_content.site_usage_rules %}{{ rules_content.site_usage_rules|safe }}{% else %}{% include 'core/rules_site_usage.html' %}{% endif %}
                    </div>
                </article>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
(function() {
    // Вкладки первого уровня: Правила тенниса / Правила турниров
    const tabBtns = document.querySelectorAll('.rules-tabs__btn');
    const tabPanels = document.querySelectorAll('.rules-tabs__content');
    tabBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
            const targetId = this.dataset.tab;
            tabBtns.forEach(function(b) {
                b.classList.toggle('rules-tabs__btn--active', b.dataset.tab === targetId);
                b.setAttribute('aria-selected', b.dataset.tab === targetId);
            });
            tabPanels.forEach(function(panel) {
                panel.style.display = panel.id === targetId ? '' : 'none';
            });
        });
    });

    // Вкладки второго уровня: FAN / Круговой / Парные
    const subtabBtns = document.querySelectorAll('.rules-subtabs__btn');
    const subtabPanels = document.querySelectorAll('.rules-subtabs__content');
    subtabBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
            const targetId = this.dataset.subtab;
            subtabBtns.forEach(function(b) {
                b.classList.toggle('rules-subtabs__btn--active', b.dataset.subtab === targetId);
            });
            subtabPanels.forEach(function(panel) {
                panel.style.display = panel.id === targetId ? '' : 'none';
            });
        });
    });
})();
</script>
{% endblock %}
